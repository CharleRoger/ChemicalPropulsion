// Remove existing tank switch
@PART:HAS[#chemTechPropellant]:AFTER[zzz_CryoTanks]
{
	-MODULE[ModuleB9PartSwitch]:HAS[#moduleID[fuelSwitch]],* {}
}
@PART:HAS[#chemTechFuel]:AFTER[zzz_CryoTanks]
{
	-MODULE[ModuleB9PartSwitch]:HAS[#moduleID[fuelSwitch]],* {}
}
@PART:HAS[#chemTechOxidizer]:AFTER[zzz_CryoTanks]
{
	-MODULE[ModuleB9PartSwitch]:HAS[#moduleID[fuelSwitch]],* {}
}

// Assign default none resource
@PART:HAS[#chemTechPropellant]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleIgnitionPropellant]:HAS[#moduleID[chemTechPropellant],~resourceName]
	{
		resourceName = none
	}
}
@PART:HAS[#chemTechFuel]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleIgnitionPropellant]:HAS[#moduleID[chemTechFuel],~resourceName]
	{
		resourceName = none
	}
}
@PART:HAS[#chemTechOxidizer]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleIgnitionPropellant]:HAS[#moduleID[chemTechOxidizer],~resourceName]
	{
		resourceName = none
	}
}

// Assign single propellants
@PART:HAS[#chemTechPropellant[Ethanol]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = Ethanol
	}
}
@PART:HAS[#chemTechPropellant[LqdOxygen]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = LqdOxygen
	}
}
@PART:HAS[#chemTechPropellant[Kerosene]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = Kerosene
	}
}
@PART:HAS[#chemTechPropellant[Aniline]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = Aniline
	}
}
@PART:HAS[#chemTechPropellant[IWFNA]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = IWFNA
	}
}
@PART:HAS[#chemTechPropellant[HTP]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = HTP
	}
}
@PART:HAS[#chemTechPropellant[Hydrazine]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = Hydrazine
	}
}
@PART:HAS[#chemTechPropellant[LqdHydrogen]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = LqdHydrogen
	}
}
@PART:HAS[#chemTechPropellant[LqdMethane]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = LqdMethane
	}
}
@PART:HAS[#chemTechPropellant[LqdAmmonia]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = LqdAmmonia
	}
}
@PART:HAS[#chemTechPropellant[Water]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = Water
	}
}
@PART:HAS[#chemTechPropellant[LqdCO2]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = LqdCO2
	}
}
@PART:HAS[#chemTechPropellant[LqdCO]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = LqdCO
	}
}
@PART:HAS[#chemTechPropellant[LqdNitrogen]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = LqdNitrogen
	}
}
@PART:HAS[#chemTechPropellant[NTO]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = NTO
	}
}
@PART:HAS[#chemTechPropellant[Pentaborane]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = Pentaborane
	}
}
@PART:HAS[#chemTechPropellant[Diborane]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = Diborane
	}
}
@PART:HAS[#chemTechPropellant[LqdFluorine]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = LqdFluorine
	}
}
@PART:HAS[#chemTechPropellant[N2F4]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = N2F4
	}
}
@PART:HAS[#chemTechPropellant[PBAN]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = PBAN
	}
}
@PART:HAS[#chemTechPropellant[HTPB]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = HTPB
	}
}
@PART:HAS[#chemTechPropellant[TEATEB]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = TEATEB
	}
}

// Assign fuels
@PART:HAS[#chemTechFuel[Ethanol]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = Ethanol
	}
}
@PART:HAS[#chemTechFuel[Kerosene]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = Kerosene
	}
}
@PART:HAS[#chemTechFuel[Aniline]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = Aniline
	}
}
@PART:HAS[#chemTechFuel[LqdAmmonia]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = LqdAmmonia
	}
}
@PART:HAS[#chemTechFuel[Hydrazine]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = Hydrazine
	}
}
@PART:HAS[#chemTechFuel[LqdMethane]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = LqdMethane
	}
}
@PART:HAS[#chemTechFuel[LqdHydrogen]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = LqdHydrogen
	}
}
@PART:HAS[#chemTechFuel[Pentaborane]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = Pentaborane
	}
}
@PART:HAS[#chemTechFuel[Diborane]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = Diborane
	}
}

// Assign oxidizers
@PART:HAS[#chemTechOxidizer[LqdOxygen]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechOxidizerSwitch]]
	{
		chemTechSwitchResourceName = LqdOxygen
	}
}
@PART:HAS[#chemTechOxidizer[IWFNA]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechOxidizerSwitch]]
	{
		chemTechSwitchResourceName = IWFNA
	}
}
@PART:HAS[#chemTechOxidizer[HTP]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechOxidizerSwitch]]
	{
		chemTechSwitchResourceName = HTP
	}
}
@PART:HAS[#chemTechOxidizer[NTO]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechOxidizerSwitch]]
	{
		chemTechSwitchResourceName = NTO
	}
}
@PART:HAS[#chemTechOxidizer[LqdFluorine]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechOxidizerSwitch]]
	{
		chemTechSwitchResourceName = LqdFluorine
	}
}
@PART:HAS[#chemTechOxidizer[N2F4]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechOxidizerSwitch]]
	{
		chemTechSwitchResourceName = N2F4
	}
}

// Attempt to convert togglable tanks to apply their volume to ModuleIgnitionTankController, e.g. for integrated tanks on an engine
// MAY HAVE UNINTENDED CONSEQUENCES!
@PART:HAS[@MODULE[ModuleIgnitionTankController]:HAS[#moduleID[chemTechFuelOxidizer]],@MODULE[ModuleB9PartSwitch]:HAS[@SUBTYPE:HAS[~tankType],@SUBTYPE:HAS[#tankType],!SUBTYPE:HAS[@MODULE:HAS[@IDENTIFIER[ModuleIgnitionTankController]]]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[@SUBTYPE:HAS[~tankType],@SUBTYPE:HAS[#tankType]]
	{
		@SUBTYPE,*
		{
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleIgnitionTankController
					moduleID = chemTechFuelOxidizer
				}
				DATA
				{
					volume = 0
				}
			}
		}
		@SUBTYPE:HAS[#tankType],*
		{
			-tankType = _
			@MODULE:HAS[@IDENTIFIER[ModuleIgnitionTankController]]
			{
				@DATA
				{
					@volume += #$../../../../chemTechTankVolumeFuelOxidizer$
				}
			}
		}
	}
}
@PART:HAS[@MODULE[ModuleIgnitionTankController]:HAS[#moduleID[chemTechFuel]],@MODULE[ModuleB9PartSwitch]:HAS[@SUBTYPE:HAS[~tankType],@SUBTYPE:HAS[#tankType]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[@SUBTYPE:HAS[~tankType],@SUBTYPE:HAS[#tankType]]
	{
		@SUBTYPE,*
		{
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleIgnitionTankController
					moduleID = chemTechFuel
				}
				DATA
				{
					volume = 0
				}
			}
		}
		@SUBTYPE:HAS[#tankType],*
		{
			-tankType = _
			@MODULE:HAS[@IDENTIFIER[ModuleIgnitionTankController]]
			{
				@DATA
				{
					@volume += #$../../../../chemTechTankVolumeFuel$
				}
			}
		}
	}
}
@PART:HAS[@MODULE[ModuleIgnitionTankController]:HAS[#moduleID[chemTechPropellant]],@MODULE[ModuleB9PartSwitch]:HAS[@SUBTYPE:HAS[~tankType],@SUBTYPE:HAS[#tankType]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[@SUBTYPE:HAS[~tankType],@SUBTYPE:HAS[#tankType]]
	{
		@SUBTYPE,*
		{
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleIgnitionTankController
					moduleID = chemTechPropellant
				}
				DATA
				{
					volume = 0
				}
			}
		}
		@SUBTYPE:HAS[#tankType],*
		{
			-tankType = _
			@MODULE:HAS[@IDENTIFIER[ModuleIgnitionTankController]]
			{
				@DATA
				{
					@volume += #$../../../../chemTechTankVolumePropellant$
				}
			}
		}
	}
}