// This patch is for both engines and RCS

// Remove existing RCS switch
@PART:HAS[@MODULE[ModuleRCS*]:HAS[#chemTechPropellant]]:BEFORE[zzz_ChemicalPropulsion]
{
	-MODULE[ModuleB9PartSwitch]:HAS[#moduleID[RCS]] {}
}
@PART:HAS[@MODULE[ModuleRCS*]:HAS[#chemTechFuel,#chemTechOxidizer]]:BEFORE[zzz_ChemicalPropulsion]
{
	-MODULE[ModuleB9PartSwitch]:HAS[#moduleID[RCS]] {}
}

// Propellant
@PART:HAS[@MODULE:HAS[#chemTechPropellant[HTP]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = HTP
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[Aniline]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = Aniline
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[Hydrazine]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = Hydrazine
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[LqdHydrogen]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = LqdHydrogen
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[LqdMethane]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = LqdMethane
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[LqdAmmonia]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = LqdAmmonia
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[Water]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = Water
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[LqdCO2]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = LqdCO2
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[LqdCO]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = LqdCO
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[LqdNitrogen]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = LqdNitrogen
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[Pentaborane]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = Pentaborane
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[Diborane]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = Diborane
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[LqdFluorine]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = LqdFluorine
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[N2F4]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = N2F4
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[PBAN]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = PBAN
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[HTPB]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = HTPB
	}
}

// Fuel
@PART:HAS[@MODULE:HAS[#chemTechFuel[Ethanol]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = Ethanol
	}
}
@PART:HAS[@MODULE:HAS[#chemTechFuel[Kerosene]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = Kerosene
	}
}
@PART:HAS[@MODULE:HAS[#chemTechFuel[Aniline]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = Aniline
	}
}
@PART:HAS[@MODULE:HAS[#chemTechFuel[LqdAmmonia]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = LqdAmmonia
	}
}
@PART:HAS[@MODULE:HAS[#chemTechFuel[Hydrazine]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = Hydrazine
	}
}
@PART:HAS[@MODULE:HAS[#chemTechFuel[LqdMethane]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = LqdMethane
	}
}
@PART:HAS[@MODULE:HAS[#chemTechFuel[LqdHydrogen]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = LqdHydrogen
	}
}
@PART:HAS[@MODULE:HAS[#chemTechFuel[Pentaborane]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = Pentaborane
	}
}
@PART:HAS[@MODULE:HAS[#chemTechFuel[Diborane]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = Diborane
	}
}

// Oxidizer
@PART:HAS[@MODULE:HAS[#chemTechOxidizer[LqdOxygen]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechOxidizerSwitch]]
	{
		chemTechSwitchResourceName = LqdOxygen
	}
}
@PART:HAS[@MODULE:HAS[#chemTechOxidizer[IWFNA]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechOxidizerSwitch]]
	{
		chemTechSwitchResourceName = IWFNA
	}
}
@PART:HAS[@MODULE:HAS[#chemTechOxidizer[HTP]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechOxidizerSwitch]]
	{
		chemTechSwitchResourceName = HTP
	}
}
@PART:HAS[@MODULE:HAS[#chemTechOxidizer[NTO]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechOxidizerSwitch]]
	{
		chemTechSwitchResourceName = NTO
	}
}
@PART:HAS[@MODULE:HAS[#chemTechOxidizer[LqdFluorine]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechOxidizerSwitch]]
	{
		chemTechSwitchResourceName = LqdFluorine
	}
}
@PART:HAS[@MODULE:HAS[#chemTechOxidizer[N2F4]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechOxidizerSwitch]]
	{
		chemTechSwitchResourceName = N2F4
	}
}

// Ignitor
@PART:HAS[@MODULE:HAS[#chemTechIgnitor[Aniline]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechIgnitorSwitch]]
	{
		chemTechSwitchResourceName = Aniline
	}
}
@PART:HAS[@MODULE:HAS[#chemTechIgnitor[Hydrazine]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechIgnitorSwitch]]
	{
		chemTechSwitchResourceName = Hydrazine
	}
}
@PART:HAS[@MODULE:HAS[#chemTechIgnitor[Pentaborane]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechIgnitorSwitch]]
	{
		chemTechSwitchResourceName = Pentaborane
	}
}
@PART:HAS[@MODULE:HAS[#chemTechIgnitor[Diborane]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechIgnitorSwitch]]
	{
		chemTechSwitchResourceName = Diborane
	}
}
@PART:HAS[@MODULE:HAS[#chemTechIgnitor[IWFNA]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechIgnitorSwitch]]
	{
		chemTechSwitchResourceName = IWFNA
	}
}
@PART:HAS[@MODULE:HAS[#chemTechIgnitor[NTO]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechIgnitorSwitch]]
	{
		chemTechSwitchResourceName = NTO
	}
}
@PART:HAS[@MODULE:HAS[#chemTechIgnitor[LqdFluorine]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechIgnitorSwitch]]
	{
		chemTechSwitchResourceName = LqdFluorine
	}
}
@PART:HAS[@MODULE:HAS[#chemTechIgnitor[N2F4]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechIgnitorSwitch]]
	{
		chemTechSwitchResourceName = N2F4
	}
}
@PART:HAS[@MODULE:HAS[#chemTechIgnitor[TEATEB]]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechIgnitorSwitch]]
	{
		chemTechSwitchResourceName = TEATEB
	}
}

// Select the first tagged resource to represent the configured engine stats
@PART:HAS[@MODULE:HAS[#chemTechPropellant]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleIgnitionPropellant]:HAS[#moduleID[chemTechPropellant]]
	{
		%resourceName = #$../MODULE:HAS[#chemTechPropellant]/chemTechPropellant,0$
	}
}
@PART:HAS[@MODULE:HAS[#chemTechFuel]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleIgnitionPropellant]:HAS[#moduleID[chemTechFuel]]
	{
		%resourceName = #$../MODULE:HAS[#chemTechFuel]/chemTechFuel,0$
	}
}
@PART:HAS[@MODULE:HAS[#chemTechOxidizer]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleIgnitionPropellant]:HAS[#moduleID[chemTechOxidizer]]
	{
		%resourceName = #$../MODULE:HAS[#chemTechOxidizer]/chemTechOxidizer,0$
	}
}