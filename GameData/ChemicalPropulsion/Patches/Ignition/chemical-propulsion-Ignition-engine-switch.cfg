// This patch is for both engines and RCS

// Remove existing RCS switch
@PART:HAS[@MODULE[ModuleRCS*]:HAS[#chemTechPropellant]]:FOR[zzz_ChemicalPropulsion]
{
	-MODULE[ModuleB9PartSwitch]:HAS[#moduleID[RCS]] {}
}
@PART:HAS[@MODULE[ModuleRCS*]:HAS[#chemTechFuel,#chemTechOxidizer]]:FOR[zzz_ChemicalPropulsion]
{
	-MODULE[ModuleB9PartSwitch]:HAS[#moduleID[RCS]] {}
}

// Propellant
@PART:HAS[@MODULE:HAS[#chemTechPropellant[HTP]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = HTP
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[Aniline]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = Aniline
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[Hydrazine]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = Hydrazine
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[LqdHydrogen]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = LqdHydrogen
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[LqdMethane]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = LqdMethane
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[LqdAmmonia]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = LqdAmmonia
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[Water]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = Water
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[LqdCO2]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = LqdCO2
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[LqdCO]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = LqdCO
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[LqdNitrogen]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = LqdNitrogen
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[Pentaborane]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = Pentaborane
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[Diborane]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = Diborane
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[LqdFluorine]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = LqdFluorine
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[N2F4]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = N2F4
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[PBAN]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = PBAN
	}
}
@PART:HAS[@MODULE:HAS[#chemTechPropellant[HTPB]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechPropellantSwitch]]
	{
		chemTechSwitchResourceName = HTPB
	}
}

// Fuel
@PART:HAS[@MODULE:HAS[#chemTechFuel[Ethanol]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = Ethanol
	}
}
@PART:HAS[@MODULE:HAS[#chemTechFuel[Kerosene]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = Kerosene
	}
}
@PART:HAS[@MODULE:HAS[#chemTechFuel[Aniline]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = Aniline
	}
}
@PART:HAS[@MODULE:HAS[#chemTechFuel[LqdAmmonia]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = LqdAmmonia
	}
}
@PART:HAS[@MODULE:HAS[#chemTechFuel[Hydrazine]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = Hydrazine
	}
}
@PART:HAS[@MODULE:HAS[#chemTechFuel[LqdMethane]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = LqdMethane
	}
}
@PART:HAS[@MODULE:HAS[#chemTechFuel[LqdHydrogen]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = LqdHydrogen
	}
}
@PART:HAS[@MODULE:HAS[#chemTechFuel[Pentaborane]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = Pentaborane
	}
}
@PART:HAS[@MODULE:HAS[#chemTechFuel[Diborane]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechFuelSwitch]]
	{
		chemTechSwitchResourceName = Diborane
	}
}

// Oxidizer
@PART:HAS[@MODULE:HAS[#chemTechOxidizer[LqdOxygen]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechOxidizerSwitch]]
	{
		chemTechSwitchResourceName = LqdOxygen
	}
}
@PART:HAS[@MODULE:HAS[#chemTechOxidizer[IWFNA]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechOxidizerSwitch]]
	{
		chemTechSwitchResourceName = IWFNA
	}
}
@PART:HAS[@MODULE:HAS[#chemTechOxidizer[HTP]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechOxidizerSwitch]]
	{
		chemTechSwitchResourceName = HTP
	}
}
@PART:HAS[@MODULE:HAS[#chemTechOxidizer[NTO]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechOxidizerSwitch]]
	{
		chemTechSwitchResourceName = NTO
	}
}
@PART:HAS[@MODULE:HAS[#chemTechOxidizer[LqdFluorine]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechOxidizerSwitch]]
	{
		chemTechSwitchResourceName = LqdFluorine
	}
}
@PART:HAS[@MODULE:HAS[#chemTechOxidizer[N2F4]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechOxidizerSwitch]]
	{
		chemTechSwitchResourceName = N2F4
	}
}

// Ignitor
@PART:HAS[@MODULE:HAS[#chemTechIgnitor[Aniline]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechIgnitorSwitch]]
	{
		chemTechSwitchResourceName = Aniline
	}
}
@PART:HAS[@MODULE:HAS[#chemTechIgnitor[Hydrazine]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechIgnitorSwitch]]
	{
		chemTechSwitchResourceName = Hydrazine
	}
}
@PART:HAS[@MODULE:HAS[#chemTechIgnitor[Pentaborane]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechIgnitorSwitch]]
	{
		chemTechSwitchResourceName = Pentaborane
	}
}
@PART:HAS[@MODULE:HAS[#chemTechIgnitor[Diborane]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechIgnitorSwitch]]
	{
		chemTechSwitchResourceName = Diborane
	}
}
@PART:HAS[@MODULE:HAS[#chemTechIgnitor[IWFNA]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechIgnitorSwitch]]
	{
		chemTechSwitchResourceName = IWFNA
	}
}
@PART:HAS[@MODULE:HAS[#chemTechIgnitor[NTO]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechIgnitorSwitch]]
	{
		chemTechSwitchResourceName = NTO
	}
}
@PART:HAS[@MODULE:HAS[#chemTechIgnitor[LqdFluorine]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechIgnitorSwitch]]
	{
		chemTechSwitchResourceName = LqdFluorine
	}
}
@PART:HAS[@MODULE:HAS[#chemTechIgnitor[N2F4]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechIgnitorSwitch]]
	{
		chemTechSwitchResourceName = N2F4
	}
}
@PART:HAS[@MODULE:HAS[#chemTechIgnitor[TEATEB]]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTechIgnitorSwitch]]
	{
		chemTechSwitchResourceName = TEATEB
	}
}

// Select the first tagged resource to represent the configured engine stats
@PART:HAS[@MODULE:HAS[#chemTechPropellant]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleIgnitionPropellant]:HAS[#moduleID[chemTechPropellant]]
	{
		%resourceName = #$../MODULE:HAS[#chemTechPropellant]/chemTechPropellant,0$
	}
}
@PART:HAS[@MODULE:HAS[#chemTechFuel]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleIgnitionPropellant]:HAS[#moduleID[chemTechFuel]]
	{
		%resourceName = #$../MODULE:HAS[#chemTechFuel]/chemTechFuel,0$
	}
}
@PART:HAS[@MODULE:HAS[#chemTechOxidizer]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleIgnitionPropellant]:HAS[#moduleID[chemTechOxidizer]]
	{
		%resourceName = #$../MODULE:HAS[#chemTechOxidizer]/chemTechOxidizer,0$
	}
}