@PART[nfex-fueltank-*]:BEFORE[zz_ChemicalPropulsion]
{
	chemTechTankType = bipropellant
	chemTechTankType = monopropellant
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		subtypeAddedMass = #$SUBTYPE[Gold]/addedMass$
		-SUBTYPE[Gold] {}
		-SUBTYPE[Silver] {}
		-SUBTYPE[Metal] {}
		-SUBTYPE[RCS] {}
		-SUBTYPE[LH2] {}
		-SUBTYPE[LH2O] {}
	}
}

// Bipropellant
@PART[nfex-fueltank-*]:HAS[#chemTechFuel[Ethanol],#chemTechOxidizer[LqdOxygen]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		SUBTYPE
		{
			name = Metal_Ethanol_LqdOxygen
			title = #LOC_ChemicalPropulsion_propellant_Ethanol_LqdOxygen_title // Ethanol / Oxygen
			tankType = ChemicalPropulsion_propellant_Ethanol_LqdOxygen
			upgradeRequired = chemical-core-partupgrade-Ethanol
		}
	}
}
@PART[nfex-fueltank-*]:HAS[#chemTechFuel[Kerosene],#chemTechOxidizer[LqdOxygen]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		SUBTYPE
		{
			name = Metal_Kerosene_LqdOxygen
			title = #LOC_ChemicalPropulsion_propellant_Kerosene_LqdOxygen_title // Kerosene / Oxygen
			tankType = ChemicalPropulsion_propellant_Kerosene_LqdOxygen
			upgradeRequired = chemical-core-partupgrade-Kerosene
		}
	}
}
@PART[nfex-fueltank-*]:HAS[#chemTechFuel[LqdHydrogen],#chemTechOxidizer[LqdOxygen]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		SUBTYPE
		{
			name = GoldFoil_LqdHydrogen_LqdOxygen
			title = #LOC_ChemicalPropulsion_propellant_LqdHydrogen_LqdOxygen_title // Hydrogen / Oxygen
			tankType = ChemicalPropulsion_propellant_LqdHydrogen_LqdOxygen
			upgradeRequired = chemical-core-partupgrade-LqdHydrogen
		}
	}
}
@PART[nfex-fueltank-*]:HAS[#chemTechFuel[LqdMethane],#chemTechOxidizer[LqdOxygen]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		SUBTYPE
		{
			name = GoldFoil_LqdMethane_LqdOxygen
			title = #LOC_ChemicalPropulsion_propellant_LqdMethane_LqdOxygen_title // Methane / Oxygen
			tankType = ChemicalPropulsion_propellant_LqdMethane_LqdOxygen
			upgradeRequired = chemical-core-partupgrade-LqdMethane
		}
	}
}
@PART[nfex-fueltank-*]:HAS[#chemTechFuel[LqdAmmonia],#chemTechOxidizer[LqdOxygen]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		SUBTYPE
		{
			name = GoldFoil_LqdAmmonia_LqdOxygen
			title = #LOC_ChemicalPropulsion_propellant_LqdAmmonia_LqdOxygen_title // Ammonia / Oxygen
			tankType = ChemicalPropulsion_propellant_LqdAmmonia_LqdOxygen
			upgradeRequired = chemical-core-partupgrade-LqdAmmonia
		}
	}
}
@PART[nfex-fueltank-*]:HAS[#chemTechFuel[Hydrazine],#chemTechOxidizer[NTO]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		SUBTYPE
		{
			name = RCS_Hydrazine_NTO
			title = #LOC_ChemicalPropulsion_propellant_Hydrazine_NTO_title // Hydrazine / NTO
			tankType = ChemicalPropulsion_propellant_Hydrazine_NTO
			upgradeRequired = chemical-core-partupgrade-NTO
		}
	}
}

// Single propellant
@PART[nfex-fueltank-*]:HAS[#chemTechFuel[Ethanol]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		SUBTYPE
		{
			name = Metal_Ethanol
			title = #LOC_ChemicalCore_Ethanol_title // Ethanol
			tankType = ChemicalCore_Ethanol
			upgradeRequired = chemical-core-partupgrade-Ethanol
		}
	}
}
@PART[nfex-fueltank-*]:HAS[#chemTechFuel[Kerosene]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		SUBTYPE
		{
			name = Metal_Kerosene
			title = #LOC_ChemicalCore_Kerosene_title // Kerosene
			tankType = ChemicalCore_Kerosene
			upgradeRequired = chemical-core-partupgrade-Kerosene
		}
	}
}
@PART[nfex-fueltank-*]:HAS[#chemTechFuel[Aniline]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		SUBTYPE
		{
			name = Metal_Aniline
			title = #LOC_ChemicalCore_Aniline_title // Aniline
			tankType = ChemicalCore_Aniline
			upgradeRequired = chemical-core-partupgrade-Aniline
		}
	}
}
@PART[nfex-fueltank-*]:HAS[#chemTechPropellant[HTP]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		SUBTYPE
		{
			name = RCS_HTP
			title = #LOC_ChemicalCore_HTP_title // High-test Peroxide
			tankType = ChemicalCore_HTP
			upgradeRequired = chemical-core-partupgrade-HTP
		}
	}
}
@PART[nfex-fueltank-*]:HAS[#chemTechPropellant[Hydrazine]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		SUBTYPE
		{
			name = RCS_Hydrazine
			title = #LOC_ChemicalCore_Hydrazine_title // Hydrazine
			tankType = ChemicalCore_Hydrazine
			upgradeRequired = chemical-core-partupgrade-Hydrazine
		}
	}
}
@PART[nfex-fueltank-*]:HAS[#chemTechFuel[LqdHydrogen]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		SUBTYPE
		{
			name = GoldFoil_LqdHydrogen
			title = #LOC_ChemicalCore_LqdHydrogen_title // Liquid Hydrogen
			tankType = ChemicalCore_LqdHydrogen
			upgradeRequired = chemical-core-partupgrade-LqdHydrogen
		}
	}
}
@PART[nfex-fueltank-*]:HAS[#chemTechFuel[LqdMethane]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		SUBTYPE
		{
			name = GoldFoil_LqdMethane
			title = #LOC_ChemicalCore_LqdMethane_title // Liquid Methane
			tankType = ChemicalCore_LqdMethane
			upgradeRequired = chemical-core-partupgrade-LqdMethane
		}
	}
}
@PART[nfex-fueltank-*]:HAS[#chemTechFuel[LqdAmmonia]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		SUBTYPE
		{
			name = GoldFoil_LqdAmmonia
			title = #LOC_ChemicalCore__title // Liquid Ammonia
			tankType = ChemicalCore_LqdAmmonia
			upgradeRequired = chemical-core-partupgrade-LqdAmmonia
		}
	}
}
@PART[nfex-fueltank-*]:HAS[#chemTechOxidizer[LqdOxygen]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		SUBTYPE
		{
			name = SilverFoil_LqdOxygen
			title = #LOC_ChemicalCore_LqdOxygen_title // Liquid Oxygen
			tankType = ChemicalCore_LqdOxygen
			upgradeRequired = chemical-core-partupgrade-LqdOxygen
		}
	}
}
@PART[nfex-fueltank-*]:HAS[#chemTechOxidizer[IWFNA]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		SUBTYPE
		{
			name = Metal_IWFNA
			title = #LOC_ChemicalCore_IWFNA_title // Nitric acid
			tankType = ChemicalCore_IWFNA
			upgradeRequired = chemical-core-partupgrade-IWFNA
		}
	}
}
@PART[nfex-fueltank-*]:HAS[#chemTechOxidizer[NTO]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		SUBTYPE
		{
			name = Metal_NTO
			title = #LOC_ChemicalCore_NTO_title // Dinitrogen Tetroxide
			tankType = ChemicalCore_NTO
			upgradeRequired = chemical-core-partupgrade-NTO
		}
	}
}
@PART[nfex-fueltank-*]:HAS[#chemTechFuel[Pentaborane]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		SUBTYPE
		{
			name = Metal_Pentaborane
			title = #LOC_ChemicalCore_Pentaborane_title // Pentaborane
			tankType = ChemicalCore_Pentaborane
			upgradeRequired = chemical-core-partupgrade-Pentaborane
		}
	}
}
@PART[nfex-fueltank-*]:HAS[#chemTechFuel[Diborane]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		SUBTYPE
		{
			name = GoldFoil_Diborane
			title = #LOC_ChemicalCore_Diborane_title // Liquid Diborane
			tankType = ChemicalCore_Diborane
			upgradeRequired = chemical-core-partupgrade-Diborane
		}
	}
}
@PART[nfex-fueltank-*]:HAS[#chemTechOxidizer[LqdFluorine]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		SUBTYPE
		{
			name = SilverFoil_LqdFluorine
			title = #LOC_ChemicalCore_LqdFluorine_title // Liquid Fluorine
			tankType = ChemicalCore_LqdFluorine
			upgradeRequired = chemical-core-partupgrade-LqdFluorine
		}
	}
}
@PART[nfex-fueltank-*]:HAS[#chemTechOxidizer[N2F4]]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		SUBTYPE
		{
			name = SilverFoil_N2F4
			title = #LOC_ChemicalCore_N2F4_title // Liquid Tetrafluorohydrazine
			tankType = ChemicalCore_N2F4
			upgradeRequired = chemical-core-partupgrade-N2F4
		}
	}
}

// Remove part upgrade restriction on first subtype and set addedMass
@PART[nfex-fueltank-*]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		@SUBTYPE,0
		{
			-upgradeRequired = _
		}
		@SUBTYPE:HAS[#tankType[Chemical*]],*
		{
			addedMass = #$../subtypeAddedMass$
		}
	}
}

// Set model transforms for tank subtypes
@PART[nfex-fueltank-radial-small-1]:AFTER[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		@SUBTYPE[Metal_*],*
		{
			transform = Tank1875_RadialLarge_Metal
		}
		@SUBTYPE[GoldFoil_*],*
		{
			transform = Tank1875_RadialLarge_Foil
		}
		@SUBTYPE[SilverFoil_*],*
		{
			transform = Tank1875_RadialLarge_FoilSilver
		}
		@SUBTYPE[RCS_*],*
		{
			transform = Tank1875_RadialLarge_RCS
		}
	}
}
@PART[nfex-fueltank-radial-small-2]:AFTER[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		@SUBTYPE[Metal_*],*
		{
			transform = Tank1875_RadialMed_Metal
		}
		@SUBTYPE[GoldFoil_*],*
		{
			transform = Tank1875_RadialMed_Foil
		}
		@SUBTYPE[SilverFoil_*],*
		{
			transform = Tank1875_RadialMed_FoilSilver
		}
		@SUBTYPE[RCS_*],*
		{
			transform = Tank1875_RadialMed_RCS
		}
	}
}
@PART[nfex-fueltank-radial-small-3]:AFTER[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		@SUBTYPE[Metal_*],*
		{
			transform = Tank1875_RadialSmall_Metal
		}
		@SUBTYPE[GoldFoil_*],*
		{
			transform = Tank1875_RadialSmall_Foil
		}
		@SUBTYPE[SilverFoil_*],*
		{
			transform = Tank1875_RadialSmall_FoilSilver
		}
		@SUBTYPE[RCS_*],*
		{
			transform = Tank1875_RadialSmall_RCS
		}
	}
}
@PART[nfex-fueltank-radial-tiny-1]:AFTER[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		@SUBTYPE[Metal_*],*
		{
			transform = ProbeTankRadial_Metal
		}
		@SUBTYPE[GoldFoil_*],*
		{
			transform = ProbeTankRadial_GoldFoil
		}
		@SUBTYPE[SilverFoil_*],*
		{
			transform = ProbeTankRadial_SilverFoil
		}
		@SUBTYPE[RCS_*],*
		{
			transform = ProbeTankRadial_RCS
		}
	}
}
@PART[nfex-fueltank-stack-medium-1]:AFTER[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		@SUBTYPE[Metal_*],*
		{
			transform = Tank1875_Large_Metal
		}
		@SUBTYPE[GoldFoil_*],*
		{
			transform = Tank1875_Large_Foil
		}
		@SUBTYPE[SilverFoil_*],*
		{
			transform = Tank1875_Large_FoilSilver
		}
		@SUBTYPE[RCS_*],*
		{
			transform = Tank1875_Large_RCS
		}
	}
}
@PART[nfex-fueltank-stack-medium-2]:AFTER[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		@SUBTYPE[Metal_*],*
		{
			transform = Tank1875_Med_Metal
		}
		@SUBTYPE[GoldFoil_*],*
		{
			transform = Tank1875_Med_Foil
		}
		@SUBTYPE[SilverFoil_*],*
		{
			transform = Tank1875_Med_FoilSilver
		}
		@SUBTYPE[RCS_*],*
		{
			transform = Tank1875_Med_RCS
		}
	}
}
@PART[nfex-fueltank-stack-medium-3]:AFTER[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		@SUBTYPE[Metal_*],*
		{
			transform = Tank1875_Short_Metal
		}
		@SUBTYPE[GoldFoil_*],*
		{
			transform = Tank1875_Short_Foil
		}
		@SUBTYPE[SilverFoil_*],*
		{
			transform = Tank1875_Short_FoilSilver
		}
		@SUBTYPE[RCS_*],*
		{
			transform = Tank1875_Short_RCS
		}
	}
}
@PART[nfex-fueltank-stack-tiny-1]:AFTER[zzz_ChemicalPropulsion]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[surfaceSwitch]]
	{
		@SUBTYPE[Metal_*],*
		{
			transform = ProbeTankMini_Metal
		}
		@SUBTYPE[GoldFoil_*],*
		{
			transform = ProbeTankMini_GoldFoil
		}
		@SUBTYPE[SilverFoil_*],*
		{
			transform = ProbeTankMini_SilverFoil
		}
		@SUBTYPE[RCS_*],*
		{
			transform = ProbeTankMini_RCS
		}
	}
}