@PART:HAS[@MODULE[ModuleIgnitionTankController]]:NEEDS[SMURFF]:FOR[zzz_ChemicalPropulsion]
{
	SMURFFExclude = true
	@mass *= 0.24

	@MODULE[ModuleIgnitionTankController],*
	{
		@addedMass *= 0.24
	}
}

@PART:HAS[@MODULE[ModuleIgnitionEngineController],@MODULE[ModuleEngines*]:HAS[#chemTechOxidizer]]:NEEDS[SMURFF]:FOR[zzz_ChemicalPropulsion]
{
	SMURFFExclude = true
	@MODULE[ModuleEngines*]:HAS[#chemTechOxidizer],*
	{
		@maxThrust *= #$@SMURFFCONFIG/enginethrustfactor$
	}
}
@PART:HAS[@MODULE[ModuleIgnitionEngineController],@MODULE[ModuleEngines*]:HAS[#chemTechOxidizer],!MODULE[ModuleCommand],~CrewCapacity[>0],!MODULE[ModuleCargoBay]]:NEEDS[SMURFF]:FOR[zzz_ChemicalPropulsion]
{
	@mass *= #$@SMURFFCONFIG/enginemassfactor$
}

@SMURFFCONFIG:NEEDS[SMURFF]
{
	// SMURFF's tank mass fraction computation for LFO, monopropellant and LH2 all arrive at almost exactly the same tank density, 0.00003 ton/litre, so just use that for everything
	chemTechTankDensity = 0.00003
}

@IgnitionPropellantConfig[Ethanol]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[Ethanol]/density$
}
@IgnitionPropellantConfig[Kerosene]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[Kerosene]/density$
}
@IgnitionPropellantConfig[Aniline]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[Aniline]/density$
}
@IgnitionPropellantConfig[LqdAmmonia]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[LqdAmmonia]/density$
}
@IgnitionPropellantConfig[Hydrazine]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[Hydrazine]/density$
}
@IgnitionPropellantConfig[LqdMethane]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[LqdMethane]/density$
}
@IgnitionPropellantConfig[LqdHydrogen]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[LqdHydrogen]/density$
}
@IgnitionPropellantConfig[Pentaborane]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[Pentaborane]/density$
}
@IgnitionPropellantConfig[Diborane]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[Diborane]/density$
}
@IgnitionPropellantConfig[TEATEB]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[TEATEB]/density$
}
@IgnitionPropellantConfig[LqdOxygen]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[LqdOxygen]/density$
}
@IgnitionPropellantConfig[IWFNA]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[IWFNA]/density$
}
@IgnitionPropellantConfig[HTP]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[HTP]/density$
}
@IgnitionPropellantConfig[NTO]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[NTO]/density$
}
@IgnitionPropellantConfig[LqdFluorine]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[LqdFluorine]/density$
}
@IgnitionPropellantConfig[N2F4]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[N2F4]/density$
}
@IgnitionPropellantConfig[PSPC]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[PSPC]/density$
}
@IgnitionPropellantConfig[PBAN]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[PBAN]/density$
}
@IgnitionPropellantConfig[HTPB]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[HTPB]/density$
}
@IgnitionPropellantConfig[Ethanol,Kerosene,Aniline,LqdAmmonia,Hydrazine,LqdMethane,LqdHydrogen,Pentaborane,Diborane,TEATEB,LqdOxygen,IWFNA,HTP,NTO,LqdFluorine,N2F4,PSPC,PBAN,HTPB]:NEEDS[SMURFF]
{
	@TankDensity != 0.6666666666666666667
	@TankDensity *= 2500000
	@TankDensity = #$TankDensity[0,.]$
	@TankDensity /= 20000000000
	massFactor = #$@SMURFFCONFIG/chemTechTankDensity$
	@massFactor /= #$TankDensity$
	@massFactor != #$@SMURFFCONFIG/tanklever$
	@TankDensity *= #$massFactor$
}

@IgnitionPropellantCombinationConfig[MonoHTP]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[HTP]/density$
}
@IgnitionPropellantCombinationConfig[MonoHydrazine]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[Hydrazine]/density$
}
@IgnitionPropellantCombinationConfig[MonoLqdHydrogen]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[LqdHydrogen]/density$
}
@IgnitionPropellantCombinationConfig[MonoLqdMethane]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[LqdMethane]/density$
}
@IgnitionPropellantCombinationConfig[MonoLqdAmmonia]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[LqdAmmonia]/density$
}
@IgnitionPropellantCombinationConfig[MonoWater]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[Water]/density$
}
@IgnitionPropellantCombinationConfig[MonoLqdCO2]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[LqdCO2]/density$
}
@IgnitionPropellantCombinationConfig[MonoLqdCO]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[LqdCO]/density$
}
@IgnitionPropellantCombinationConfig[MonoLqdNitrogen]:NEEDS[SMURFF]
{
	TankDensity = #$@RESOURCE_DEFINITION[LqdNitrogen]/density$
}
@IgnitionPropellantCombinationConfig[MonoHTP,MonoHydrazine,MonoLqdHydrogen,MonoLqdMethane,MonoLqdAmmonia,MonoWater,MonoLqdCO2,MonoLqdCO,MonoLqdNitrogen]:NEEDS[SMURFF]
{
	@TankDensity != 0.6666666666666666667
	@TankDensity *= 2500000
	@TankDensity = #$TankDensity[0,.]$
	@TankDensity /= 200000000
	massFactor = #$@SMURFFCONFIG/chemTechTankDensity$
	@massFactor /= #$TankDensity$
	@massFactor != #$@SMURFFCONFIG/tanklever$
	@TankDensity *= #$massFactor$
}