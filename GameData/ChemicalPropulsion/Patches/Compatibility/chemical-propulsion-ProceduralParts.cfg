// Tanks

// Bipropellant
@PART:HAS[~chemTechTankType,@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[@TANK_TYPE_OPTION:HAS[@RESOURCE[LiquidFuel],@RESOURCE[Oxidizer]]]]:NEEDS[ProceduralParts]:BEFORE[zz_ChemicalPropulsion]
{
	chemTechTankType = bipropellant
	@MODULE[TankContentSwitcher]:HAS[@TANK_TYPE_OPTION:HAS[@RESOURCE[LiquidFuel],@RESOURCE[Oxidizer]]]
	{
		chemTechUnitsPerT = #$TANK_TYPE_OPTION:HAS[@RESOURCE[LiquidFuel],@RESOURCE[Oxidizer]]/RESOURCE[LiquidFuel]/unitsPerT$
		@chemTechUnitsPerT += #$TANK_TYPE_OPTION:HAS[@RESOURCE[LiquidFuel],@RESOURCE[Oxidizer]]/RESOURCE[Oxidizer]/unitsPerT$
		@chemTechUnitsPerT *= 0.5432485 // Don't ask
		-TANK_TYPE_OPTION,* {}
	}
}

// Aviation
@PART:HAS[~chemTechTankType,@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[@TANK_TYPE_OPTION:HAS[@RESOURCE[LiquidFuel],!RESOURCE[Oxidizer]]]]:NEEDS[ProceduralParts]:BEFORE[zz_ChemicalPropulsion]
{
	chemTechTankType = aviation
	@MODULE[TankContentSwitcher]:HAS[@TANK_TYPE_OPTION:HAS[@RESOURCE[LiquidFuel],!RESOURCE[Oxidizer]]]
	{
		chemTechUnitsPerT = #$TANK_TYPE_OPTION:HAS[@RESOURCE[LiquidFuel],!RESOURCE[Oxidizer]]/RESOURCE[LiquidFuel]/unitsPerT$
		@chemTechUnitsPerT *= 0.5432485 // Don't ask
		-TANK_TYPE_OPTION,* {}
	}
}

// Monopropellant
@PART:HAS[~chemTechTankType,@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[@TANK_TYPE_OPTION:HAS[@RESOURCE[MonoPropellant]]]]:NEEDS[ProceduralParts]:BEFORE[zz_ChemicalPropulsion]
{
	chemTechTankType = monopropellant
	@MODULE[TankContentSwitcher]:HAS[@TANK_TYPE_OPTION:HAS[@RESOURCE[MonoPropellant]]]
	{
		chemTechUnitsPerT = #$TANK_TYPE_OPTION:HAS[@RESOURCE[MonoPropellant]]/RESOURCE[MonoPropellant]/unitsPerT$
		@chemTechUnitsPerT *= 0.8691975 // Don't ask
		-TANK_TYPE_OPTION,* {}
	}
}

// Bipropellant
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Ethanol_LqdOxygen]],#chemTechFuel[Ethanol],#chemTechOxidizer[LqdOxygen]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Ethanol_LqdOxygen]]
	{
		TANK_TYPE_OPTION
		{
			name = Ethanol_LqdOxygen
			fuelDryDensity = #$@RESOURCE_DEFINITION[Ethanol]/density$
			oxidizerDryDensity = #$@RESOURCE_DEFINITION[LqdOxygen]/density$
			RESOURCE
			{
				name = Ethanol
				unitsPerT = 0.5
			}
			RESOURCE
			{
				name = LqdOxygen
				unitsPerT = 0.5
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Kerosene_LqdOxygen]],#chemTechFuel[Kerosene],#chemTechOxidizer[LqdOxygen]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Kerosene_LqdOxygen]]
	{
		TANK_TYPE_OPTION
		{
			name = Kerosene_LqdOxygen
			fuelDryDensity = #$@RESOURCE_DEFINITION[Kerosene]/density$
			oxidizerDryDensity = #$@RESOURCE_DEFINITION[LqdOxygen]/density$
			RESOURCE
			{
				name = Kerosene
				unitsPerT = 0.375
			}
			RESOURCE
			{
				name = LqdOxygen
				unitsPerT = 0.625
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdHydrogen_LqdOxygen]],#chemTechFuel[LqdHydrogen],#chemTechOxidizer[LqdOxygen]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdHydrogen_LqdOxygen]]
	{
		TANK_TYPE_OPTION
		{
			name = LqdHydrogen_LqdOxygen
			fuelDryDensity = #$@RESOURCE_DEFINITION[LqdHydrogen]/density$
			oxidizerDryDensity = #$@RESOURCE_DEFINITION[LqdOxygen]/density$
			RESOURCE
			{
				name = LqdHydrogen
				unitsPerT = 0.75
			}
			RESOURCE
			{
				name = LqdOxygen
				unitsPerT = 0.25
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdMethane_LqdOxygen]],#chemTechFuel[LqdMethane],#chemTechOxidizer[LqdOxygen]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdMethane_LqdOxygen]]
	{
		TANK_TYPE_OPTION
		{
			name = LqdMethane_LqdOxygen
			fuelDryDensity = #$@RESOURCE_DEFINITION[LqdMethane]/density$
			oxidizerDryDensity = #$@RESOURCE_DEFINITION[LqdOxygen]/density$
			RESOURCE
			{
				name = LqdMethane
				unitsPerT = 0.4375
			}
			RESOURCE
			{
				name = LqdOxygen
				unitsPerT = 0.5625
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdAmmonia_LqdOxygen]],#chemTechFuel[LqdAmmonia],#chemTechOxidizer[LqdOxygen]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdAmmonia_LqdOxygen]]
	{
		TANK_TYPE_OPTION
		{
			name = LqdAmmonia_LqdOxygen
			fuelDryDensity = #$@RESOURCE_DEFINITION[LqdAmmonia]/density$
			oxidizerDryDensity = #$@RESOURCE_DEFINITION[LqdOxygen]/density$
			RESOURCE
			{
				name = LqdAmmonia
				unitsPerT = 0.4375
			}
			RESOURCE
			{
				name = LqdOxygen
				unitsPerT = 0.5625
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Hydrazine_NTO]],#chemTechFuel[Hydrazine],#chemTechOxidizer[NTO]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Hydrazine_NTO]]
	{
		TANK_TYPE_OPTION
		{
			name = Hydrazine_NTO
			fuelDryDensity = #$@RESOURCE_DEFINITION[Hydrazine]/density$
			oxidizerDryDensity = #$@RESOURCE_DEFINITION[NTO]/density$
			RESOURCE
			{
				name = Hydrazine
				unitsPerT = 0.4375
			}
			RESOURCE
			{
				name = NTO
				unitsPerT = 0.5625
			}
		}
	}
}

// Single propellant
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Ethanol]],#chemTechFuel[Ethanol]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Ethanol]]
	{
		TANK_TYPE_OPTION
		{
			name = Ethanol
			dryDensity = #$@RESOURCE_DEFINITION[Ethanol]/density$
			RESOURCE
			{
				name = Ethanol
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Kerosene]],#chemTechFuel[Kerosene]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Kerosene]]
	{
		TANK_TYPE_OPTION
		{
			name = Kerosene
			dryDensity = #$@RESOURCE_DEFINITION[Kerosene]/density$
			RESOURCE
			{
				name = Kerosene
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Aniline]],#chemTechFuel[Aniline]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Aniline]]
	{
		TANK_TYPE_OPTION
		{
			name = Aniline
			dryDensity = #$@RESOURCE_DEFINITION[Aniline]/density$
			RESOURCE
			{
				name = Aniline
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[HTP]],#chemTechOxidizer[HTP]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[HTP]]
	{
		TANK_TYPE_OPTION
		{
			name = HTP
			dryDensity = #$@RESOURCE_DEFINITION[HTP]/density$
			RESOURCE
			{
				name = HTP
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Hydrazine]],#chemTechFuel[Hydrazine]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Hydrazine]]
	{
		TANK_TYPE_OPTION
		{
			name = Hydrazine
			dryDensity = #$@RESOURCE_DEFINITION[Hydrazine]/density$
			RESOURCE
			{
				name = Hydrazine
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdHydrogen]],#chemTechFuel[LqdHydrogen]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdHydrogen]]
	{
		TANK_TYPE_OPTION
		{
			name = LqdHydrogen
			dryDensity = #$@RESOURCE_DEFINITION[LqdHydrogen]/density$
			RESOURCE
			{
				name = LqdHydrogen
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdMethane]],#chemTechFuel[LqdMethane]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdMethane]]
	{
		TANK_TYPE_OPTION
		{
			name = LqdMethane
			dryDensity = #$@RESOURCE_DEFINITION[LqdMethane]/density$
			RESOURCE
			{
				name = LqdMethane
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdAmmonia]],#chemTechFuel[LqdAmmonia]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdAmmonia]]
	{
		TANK_TYPE_OPTION
		{
			name = LqdAmmonia
			dryDensity = #$@RESOURCE_DEFINITION[LqdAmmonia]/density$
			RESOURCE
			{
				name = LqdAmmonia
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdOxygen]],#chemTechOxidizer[LqdOxygen]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdOxygen]]
	{
		TANK_TYPE_OPTION
		{
			name = LqdOxygen
			dryDensity = #$@RESOURCE_DEFINITION[LqdOxygen]/density$
			RESOURCE
			{
				name = LqdOxygen
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[IWFNA]],#chemTechOxidizer[IWFNA]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[IWFNA]]
	{
		TANK_TYPE_OPTION
		{
			name = IWFNA
			dryDensity = #$@RESOURCE_DEFINITION[IWFNA]/density$
			RESOURCE
			{
				name = IWFNA
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[NTO]],#chemTechOxidizer[NTO]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[NTO]]
	{
		TANK_TYPE_OPTION
		{
			name = NTO
			dryDensity = #$@RESOURCE_DEFINITION[NTO]/density$
			RESOURCE
			{
				name = NTO
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Pentaborane]],#chemTechFuel[Pentaborane]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Pentaborane]]
	{
		TANK_TYPE_OPTION
		{
			name = Pentaborane
			dryDensity = #$@RESOURCE_DEFINITION[Pentaborane]/density$
			RESOURCE
			{
				name = Pentaborane
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Diborane]],#chemTechFuel[Diborane]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Diborane]]
	{
		TANK_TYPE_OPTION
		{
			name = Diborane
			dryDensity = #$@RESOURCE_DEFINITION[Diborane]/density$
			RESOURCE
			{
				name = Diborane
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdFluorine]],#chemTechOxidizer[LqdFluorine]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdFluorine]]
	{
		TANK_TYPE_OPTION
		{
			name = LqdFluorine
			dryDensity = #$@RESOURCE_DEFINITION[LqdFluorine]/density$
			RESOURCE
			{
				name = LqdFluorine
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[N2F4]],#chemTechOxidizer[N2F4]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[N2F4]]
	{
		TANK_TYPE_OPTION
		{
			name = N2F4
			dryDensity = #$@RESOURCE_DEFINITION[N2F4]/density$
			RESOURCE
			{
				name = N2F4
			}
		}
	}
}

// Single propellants
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Ethanol]],#chemTechPropellant[Ethanol]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Ethanol]]
	{
		TANK_TYPE_OPTION
		{
			name = Ethanol
			dryDensity = #$@RESOURCE_DEFINITION[Ethanol]/density$
			RESOURCE
			{
				name = Ethanol
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Kerosene]],#chemTechPropellant[Kerosene]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Kerosene]]
	{
		TANK_TYPE_OPTION
		{
			name = Kerosene
			dryDensity = #$@RESOURCE_DEFINITION[Kerosene]/density$
			RESOURCE
			{
				name = Kerosene
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Aniline]],#chemTechPropellant[Aniline]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Aniline]]
	{
		TANK_TYPE_OPTION
		{
			name = Aniline
			dryDensity = #$@RESOURCE_DEFINITION[Aniline]/density$
			RESOURCE
			{
				name = Aniline
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[HTP]],#chemTechPropellant[HTP]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[HTP]]
	{
		TANK_TYPE_OPTION
		{
			name = HTP
			dryDensity = #$@RESOURCE_DEFINITION[HTP]/density$
			RESOURCE
			{
				name = HTP
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Hydrazine]],#chemTechPropellant[Hydrazine]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Hydrazine]]
	{
		TANK_TYPE_OPTION
		{
			name = Hydrazine
			dryDensity = #$@RESOURCE_DEFINITION[Hydrazine]/density$
			RESOURCE
			{
				name = Hydrazine
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdHydrogen]],#chemTechPropellant[LqdHydrogen]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdHydrogen]]
	{
		TANK_TYPE_OPTION
		{
			name = LqdHydrogen
			dryDensity = #$@RESOURCE_DEFINITION[LqdHydrogen]/density$
			RESOURCE
			{
				name = LqdHydrogen
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdMethane]],#chemTechPropellant[LqdMethane]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdMethane]]
	{
		TANK_TYPE_OPTION
		{
			name = LqdMethane
			dryDensity = #$@RESOURCE_DEFINITION[LqdMethane]/density$
			RESOURCE
			{
				name = LqdMethane
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdAmmonia]],#chemTechPropellant[LqdAmmonia]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdAmmonia]]
	{
		TANK_TYPE_OPTION
		{
			name = LqdAmmonia
			dryDensity = #$@RESOURCE_DEFINITION[LqdAmmonia]/density$
			RESOURCE
			{
				name = LqdAmmonia
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdOxygen]],#chemTechPropellant[LqdOxygen]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdOxygen]]
	{
		TANK_TYPE_OPTION
		{
			name = LqdOxygen
			dryDensity = #$@RESOURCE_DEFINITION[LqdOxygen]/density$
			RESOURCE
			{
				name = LqdOxygen
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[IWFNA]],#chemTechPropellant[IWFNA]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[IWFNA]]
	{
		TANK_TYPE_OPTION
		{
			name = IWFNA
			dryDensity = #$@RESOURCE_DEFINITION[IWFNA]/density$
			RESOURCE
			{
				name = IWFNA
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[NTO]],#chemTechPropellant[NTO]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[NTO]]
	{
		TANK_TYPE_OPTION
		{
			name = NTO
			dryDensity = #$@RESOURCE_DEFINITION[NTO]/density$
			RESOURCE
			{
				name = NTO
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[TEATEB]],#chemTechPropellant[TEATEB]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[TEATEB]]
	{
		TANK_TYPE_OPTION
		{
			name = TEATEB
			dryDensity = #$@RESOURCE_DEFINITION[TEATEB]/density$
			RESOURCE
			{
				name = TEATEB
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Pentaborane]],#chemTechPropellant[Pentaborane]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Pentaborane]]
	{
		TANK_TYPE_OPTION
		{
			name = Pentaborane
			dryDensity = #$@RESOURCE_DEFINITION[Pentaborane]/density$
			RESOURCE
			{
				name = Pentaborane
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Diborane]],#chemTechPropellant[Diborane]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[Diborane]]
	{
		TANK_TYPE_OPTION
		{
			name = Diborane
			dryDensity = #$@RESOURCE_DEFINITION[Diborane]/density$
			RESOURCE
			{
				name = Diborane
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdFluorine]],#chemTechPropellant[LqdFluorine]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[LqdFluorine]]
	{
		TANK_TYPE_OPTION
		{
			name = LqdFluorine
			dryDensity = #$@RESOURCE_DEFINITION[LqdFluorine]/density$
			RESOURCE
			{
				name = LqdFluorine
			}
		}
	}
}
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[N2F4]],#chemTechPropellant[N2F4]]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[!TANK_TYPE_OPTION[N2F4]]
	{
		TANK_TYPE_OPTION
		{
			name = N2F4
			dryDensity = #$@RESOURCE_DEFINITION[N2F4]/density$
			RESOURCE
			{
				name = N2F4
			}
		}
	}
}

// Compute dry density
@PART:HAS[@MODULE[ProceduralPart],@MODULE[TankContentSwitcher],#chemTechTankType]:NEEDS[ProceduralParts]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]
	{
		@TANK_TYPE_OPTION:HAS[#fuelDryDensity,#oxidizerDryDensity],*
		{
			@fuelDryDensity *= #$RESOURCE,0/unitsPerT$
			@oxidizerDryDensity *= #$RESOURCE,1/unitsPerT$
			dryDensity = #$fuelDryDensity$
			@dryDensity += #$oxidizerDryDensity$
		}
		@TANK_TYPE_OPTION,*
		{
			@dryDensity *= 1000 // kg/m³ -> g/cm³
			@dryDensity != 0.6666666666666666667 // Density scaling following CryoTanks example
			@dryDensity *= 0.10865 // Stock tank density
			@RESOURCE:HAS[~unitsPerT],*
			{
				unitsPerT = 1
			}
			@RESOURCE,*
			{
				@unitsPerT *= #$../../chemTechUnitsPerT$
				@unitsPerT /= #$../dryDensity$
			}
		}
	}
}

// Engines

// SRBs
@PART:HAS[~chemTechTankType,@MODULE[ProceduralPart],@MODULE[ProceduralSRB],@MODULE[TankContentSwitcher]:HAS[@TANK_TYPE_OPTION:HAS[@RESOURCE[SolidFuel]]]]:NEEDS[ProceduralParts]:FOR[zzz_ChemicalPropulsion]
{
	@MODULE[TankContentSwitcher]:HAS[@TANK_TYPE_OPTION:HAS[@RESOURCE[SolidFuel]]]
	{
		@TANK_TYPE_OPTION:HAS[@RESOURCE[SolidFuel]]
		{
			@name = PBAN
			@RESOURCE
			{
				@name = PBAN
				@unitsPerT *= 5.853975 // Don't ask
			}
		}
	}
	@MODULE[ModuleEngines*]
	{
		-PROPELLANT,* {}
		PROPELLANT
		{
			name = PBAN
			ratio = 1.0
			DrawGauge = True
		}
	}
}

// Remove any Ignition modules accidentally added
@PART:HAS[@MODULE[ProceduralPart],@MODULE[ModuleIgnition*]]:NEEDS[ProceduralParts]:AFTER[zzz_ChemicalPropulsion]
{
	-MODULE[ModuleIgnition*],* {}
	-MODULE[ModuleB9PartSwitch]:HAS[#moduleID[chemTech*Switch]],* {}
}